<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>게시판 목록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* 이미지의 고정 크기 */
        .img-thumbnail {
            width: 125px; /* 고정 너비 */
            height: 125px; /* 고정 높이 */
            object-fit: cover; /* 이미지가 잘리지 않도록 유지 */
        }

        /* 이미지가 없는 경우 대체 스타일 */
        .img-placeholder {
            display: inline-block;
            width: 100px; /* 고정 너비 */
            height: 100px; /* 고정 높이 */
            background-color: #e9ecef; /* 배경색 */
            border: 1px solid #dee2e6; /* 테두리 */
            text-align: center; /* 텍스트 가운데 정렬 */
            line-height: 100px; /* 높이 맞추기 */
            color: #6c757d; /* 텍스트 색 */
            font-size: 14px;
        }

        .table {
            table-layout: fixed;
            width: 100%;
        }

        .table th, .table td {
            vertical-align: middle;
            word-wrap: break-word;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 50px;
            height: 50px;
        }

        .table th:nth-child(1), .table td:nth-child(1) {
            width: 5%;
        }

        .table th:nth-child(2), .table td:nth-child(2) {
            width: 35%;
        }

        /*.table th:nth-child(3), .table td:nth-child(3) {*/
        /*    width: 20%;*/
        /*}*/

        .table th:nth-child(3), .table td:nth-child(3) {
            width: 10%;
        }

        .table th:nth-child(4), .table td:nth-child(4) {
            width: 15%;
        }

        .table th:nth-child(5), .table td:nth-child(5) {
            width: 15%;
        }

        .table th:nth-child(6), .table td:nth-child(6) {
            width: 15%;
        }

        .table th:nth-child(7), .table td:nth-child(7) {
            width: 20%;
        }

        .container {
            margin-top: 20px;
        }

        .clickable-row {
            cursor: pointer; /* 클릭 가능한 포인터 표시 */
        }
        .footer-padding {
            height: 70px;
        }
    </style>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const dateElements = document.querySelectorAll('.relative-time');

            dateElements.forEach(element => {
                // Thymeleaf에서 렌더링된 data-created-at 값 가져오기
                const createdAt = element.dataset.createdAt; // data-created-at 속성
                console.log("Thymeleaf에서 전달된 날짜:", createdAt);

                if (!createdAt) {
                    console.error("data-created-at 속성이 비어 있습니다.");
                    return;
                }

                // 날짜 계산
                const createdDate = new Date(createdAt);
                const now = new Date();
                const diffInMilliseconds = now - createdDate;

                const diffInMinutes = Math.floor(diffInMilliseconds / (1000 * 60));
                const diffInHours = Math.floor(diffInMinutes / 60);
                const diffInDays = Math.floor(diffInHours / 24);

                let relativeTime = "";
                if (diffInDays >= 1) {
                    relativeTime = `${diffInDays}일 전`;
                } else if (diffInHours >= 1) {
                    relativeTime = `${diffInHours}시간 전`;
                } else if (diffInMinutes >= 1) {
                    relativeTime = `${diffInMinutes}분 전`;
                } else {
                    relativeTime = "방금 전";
                }

                console.log("계산된 상대 시간:", relativeTime);

                // HTML 업데이트
                element.textContent = relativeTime;
            });
        });

        // 클릭 이벤트로 페이지 이동 처리
        function goToBoardPage(boardId) {
            location.href = `/board/${boardId}`;
        }

    </script>
</head>
<body>
<!-- Header -->
<div th:replace="~{layouts/header :: header}"></div>

<!-- Main Content -->
<div class="container mt-5">
    <h1 class="mb-4">게시판 목록</h1>

    <!-- 게시판 목록 테이블 -->
    <table class="table table-hover">
        <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">제목</th>
<!--            <th scope="col">내용</th>-->
            <th scope="col">작성자</th>
            <th scope="col">상태</th>
            <th scope="col">조회수</th>
            <th scope="col">생성일</th>
            <th scope="col">대표 이미지</th>
        </tr>
        </thead>
        <tbody>
        <!-- 게시판 데이터 반복 -->
        <tr th:each="board : ${boards.content}" class="clickable-row"
            th:onclick="|goToBoardPage(${board.boardId})|">

            <!-- 번호 -->
            <th scope="row" th:text="${board.boardId}">1</th>

            <!-- 제목 -->
            <td th:text="${board.title.length() > 10 ? board.title.substring(0, 10) + '...' : board.title}">내용
            </td>

            <!-- 내용 (최대 10자 제한) -->
<!--            <td th:text="${board.content.length() > 10 ? board.content.substring(0, 10) + '...' : board.content}">내용-->
<!--            </td>-->

            <!-- 작성자 이름 -->
            <td th:text="${board.memberName}">작성자</td>

            <!-- 상태 -->
            <td th:text="${board.status}">상태</td>

            <!-- 조회수 -->
            <td th:text="${board.viewCount}">조회수</td>

            <!-- 생성일 -->
            <td>
                <!-- 기본 작성일 표시 -->
                <span class="created-date"
                      th:text="${#temporals.format(board.createdAt, 'yyyy.MM.dd')}">2025.01.17</span>
                <!-- 상대 시간 표시 -->
                <small class="text-muted relative-time" th:attr="data-created-at=${board.createdAt}"></small>
            </td>

            <!-- 대표 이미지 -->
            <td>
                <div>
                    <img th:if="${board.imageUrls.size() > 0}"
                         th:src="${board.imageUrls[0]}"
                         alt="대표 이미지"
                         class="img-thumbnail">
                    <!-- 대표 이미지가 없을 때 -->
                    <img th:if="${board.imageUrls.size() == 0}"
                         th:src="@{/images/noImage.png}"
                         alt="기본 이미지"
                         class="img-thumbnail">
                </div>
            </td>

        </tr>
        </tbody>
    </table>

    <!-- 페이징 -->
    <nav th:if="${boards.totalPages > 1}" class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${boards.hasPrevious() ? '' : 'disabled'}">
                <a class="page-link" th:href="@{/boards(page=${boards.number - 1})}" aria-label="이전">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li class="page-item" th:each="pageNum : ${#numbers.sequence(0, boards.totalPages - 1)}"
                th:classappend="${pageNum == boards.number ? 'active' : ''}">
                <a class="page-link" th:href="@{/boards(page=${pageNum})}" th:text="${pageNum + 1}">1</a>
            </li>
            <li class="page-item" th:classappend="${boards.hasNext() ? '' : 'disabled'}">
                <a class="page-link" th:href="@{/boards(page=${boards.number + 1})}" aria-label="다음">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>
</div>

<!-- 푸터 아래 추가 여백 -->
<div class="footer-padding"></div>

<!-- Footer -->
<div th:replace="~{layouts/footer :: footer}"></div>

</body>
</html>