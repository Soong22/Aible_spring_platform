<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>게시판 작성</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* 메인 컨테이너 스타일 */
        .container {
            max-width: 800px;
            margin: auto;
        }

        /* 파일 리스트 스타일 */
        #fileList {
            margin-top: 10px;
            padding: 0;
            list-style: none;
        }

        #fileList li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }

        /* X 버튼 스타일 */
        #fileList li button {
            font-size: 14px;
            color: white;
            background-color: #dc3545;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
        }

        #fileList li button:hover {
            background-color: #c82333;
        }
    </style>
    <script>
        // 뒤로가기 시 강제 새로고침
        if (performance.getEntriesByType("navigation")[0]?.type === "back_forward") {
            location.reload(true);
        }
    </script>
</head>
<body>
<!-- Header -->
<div th:replace="~{layouts/header :: header}"></div>

<!-- Main Content -->
<div class="container mt-5">
    <h1 class="mb-4">게시판 작성</h1>

    <!-- 게시판 작성 폼 -->
    <form th:action="@{/board/register}" method="post" enctype="multipart/form-data" id="boardForm"
          onsubmit="return confirmSubmit()">

        <!-- 제목 -->
        <div class="mb-3">
            <label for="title" class="form-label">제목</label>
            <input type="text" id="title" name="title" class="form-control" required minlength="1" maxlength="50"
                   placeholder="제목을 입력하세요">
        </div>

        <!-- 내용 -->
        <div class="mb-3">
            <label for="content" class="form-label">내용</label>
            <textarea id="content" name="content" rows="5" class="form-control" required minlength="1"
                      maxlength="10000" placeholder="내용을 입력하세요"></textarea>
        </div>

        <!-- 이미지 파일 업로드 -->
        <div class="mb-3">
            <label for="photoFiles" class="form-label">이미지 파일 (선택)</label>
            <input type="file" id="photoFiles" name="photoFiles" class="form-control" multiple>
            <ul id="fileList"></ul>
        </div>

        <!-- 버튼 -->
        <div class="d-flex justify-content-start gap-2">
            <button type="submit" class="btn btn-primary">작성하기</button>
            <button type="button" class="btn btn-secondary" onclick="cancelEdit()">취소</button>
        </div>
    </form>
</div>

<!-- Footer -->
<div th:replace="~{layouts/footer :: footer}"></div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const photoFilesInput = document.getElementById("photoFiles");
        const fileList = document.getElementById("fileList");
        let selectedFiles = [];

        // 파일 선택 시 파일 리스트 갱신
        photoFilesInput.addEventListener("change", function () {
            const files = Array.from(photoFilesInput.files);
            selectedFiles = files.filter(file => file.size > 0); // 빈 파일 제거
            updateFileList();
        });

        // 파일 삭제
        window.removeFile = function (index) {
            selectedFiles.splice(index, 1); // 파일 삭제
            updateFileList();
        };

        // 파일 리스트 렌더링
        function updateFileList() {
            fileList.innerHTML = ""; // 기존 리스트 초기화
            selectedFiles.forEach((file, index) => {
                const listItem = document.createElement("li");
                listItem.innerHTML = `
                  <span>${file.name}</span>
                  <button type="button" onclick="removeFile(${index})">X</button>
                `;
                fileList.appendChild(listItem);
            });

            // DataTransfer로 input의 파일 갱신
            const dataTransfer = new DataTransfer();
            selectedFiles.forEach(file => dataTransfer.items.add(file));
            photoFilesInput.files = dataTransfer.files;
        }
    });

    // 폼 제출 시 확인창 표시
    function confirmSubmit() {
        return confirm("작성하시겠습니까?");
    }

    // 취소 버튼 동작
    function cancelEdit() {
        if (confirm("작성 중인 내용을 취소하시겠습니까?")) {
            window.location.href = "/";
        }
    }
</script>
</body>
</html>
