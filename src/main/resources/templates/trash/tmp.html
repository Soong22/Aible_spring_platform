<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title th:text="${board.title}">게시글 보기</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <style>
    body {
      background-color: #f8f9fa;
      margin: 0;
      padding: 0;
    }

    .board-container {
      max-width: 800px;
      margin: 40px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .board-header {
      border-bottom: 2px solid #e9ecef;
      padding-bottom: 15px;
      margin-bottom: 20px;
    }

    .board-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .board-info {
      font-size: 14px;
      color: #6c757d;
    }

    .board-images {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: flex-start; /* 이미지를 중앙 정렬 */
    }

    .board-image {
      width: 60%; /* 폼의 폭의 3/4 */
      height: 60%; /* 폭과 동일한 높이 */
      object-fit: cover; /* 이미지 비율 유지 */
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .board-content {
      font-size: 16px;
      line-height: 1.6;
      margin-top: 20px;
      white-space: pre-wrap; /* 줄바꿈 및 공백 유지 */
      word-wrap: break-word; /* 긴 단어를 줄바꿈 */
      overflow-wrap: break-word;
    }

    .divider {
      height: 1px;
      background-color: #e9ecef;
      margin: 40px 0;
    }

    .comments-section {
      margin-top: 20px;
    }

    .comment-card {
      background-color: #f1f3f5;
      border: 1px solid #dee2e6;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 15px;
    }

    .comment-author {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .comment-date {
      font-size: 12px;
      color: #adb5bd;
      margin-bottom: 10px;
    }

    .board-actions {
      text-align: right;
      margin-top: 20px;
    }

    .footer-padding {
      height: 70px;
    }
  </style>
</head>
<body>

<!-- Header -->
<div th:replace="~{layouts/header :: header}"></div>

<!-- Main Content -->
<div class="board-container">
  <!-- 게시글 제목 -->
  <div class="board-header">
    <h1 class="board-title" th:text="${board.title}">게시글 제목</h1>
    <p class="board-info">
      작성자: <span th:text="${board.memberName}">작성자</span> |
      작성일: <span th:text="${#temporals.format(board.createdAt, 'yyyy.MM.dd HH:mm')}">2025.01.17 16:49</span> |
      조회수: <span th:text="${board.viewCount}">0</span> |
      <span th:if="${board.status == '확인대기'}">(확인대기)</span>
      <span th:if="${board.status == '확인완료'}">(확인완료)</span>
    </p>
  </div>

  <!-- 이미지 목록 -->
  <div class="board-images" th:if="${board.imageUrls.size() > 0}">
    <img th:each="imageUrl : ${board.imageUrls}" th:src="${imageUrl}" alt="게시글 이미지" class="board-image">
  </div>

  <!-- 게시글 내용 -->
  <div class="board-content" th:utext="${#strings.replace(board.content, '\n', '<br>')}">
    게시글 내용이 여기에 표시됩니다.
  </div>

  <!-- 수정/삭제 버튼 -->
  <div class="board-actions" th:if="${isTrue}">
    <button class="btn btn-primary" th:onclick="|location.href='/board/edit/' + ${board.boardId}|">수정</button>
    <form th:action="@{/board/delete/{boardId}(boardId=${board.boardId})}" method="post"
          onsubmit="return confirm('정말로 삭제하시겠습니까?');" class="d-inline">
      <button type="submit" class="btn btn-danger">삭제</button>
    </form>
  </div>

  <!-- 구분선 -->
  <div class="divider"></div>


  <!--    나중에 댓글 구현시 여기 수정 필요-->
  <!-- 댓글 섹션 -->
  <div class="comments-section">
    <h3>댓글</h3>
    <div th:each="comment : ${board.comments}" class="comment-card">
      <div class="comment-author" th:text="${comment.authorName}">댓글 작성자</div>
      <div class="comment-date" th:text="${#temporals.format(comment.createdAt, 'yyyy.MM.dd HH:mm')}">2025.01.17
        17:00
      </div>
      <p th:text="${comment.content}">댓글 내용</p>
    </div>
    <p th:if="${board.comments.size() == 0}" class="text-muted">댓글이 없습니다.</p>
  </div>

  <!-- 댓글 목록 -->
  <h5>댓글</h5>
  <div th:each="comment : ${board.comments}" class="mb-3">
    <div class="p-3 border rounded bg-light">
      <div class="fw-bold" th:text="${comment.authorName}">작성자</div>
      <div class="text-muted" th:text="${#temporals.format(comment.createdAt, 'yyyy.MM.dd HH:mm')}">날짜</div>
      <div th:text="${comment.content}">댓글 내용</div>

      <!-- 만약 댓글에도 이미지가 있다면, 아래처럼 보여줄 수도 있음 -->
      <!--
      <div th:if="${comment.imageUrls != null}">
          <img th:each="imgUrl : ${comment.imageUrls}"
               th:src="${imgUrl}" style="width:80px;height:80px;object-fit:cover;margin-right:5px;">
      </div>
      -->
    </div>
  </div>

  <div th:if="${board.comments.size()} == 0" class="text-muted">
    댓글이 없습니다.
  </div>

  <hr/>

  <!-- 댓글 작성 폼 -->
  <div class="mt-4">
    <h5>댓글 달기</h5>

    <!-- multipart/form-data로 서버에 전송 -->
    <form th:action="@{/comments}" method="post" enctype="multipart/form-data" class="mb-3">
      <!-- 게시글 ID를 함께 전송 -->
      <input type="hidden" name="boardId" th:value="${board.boardId}"/>

      <!-- 댓글 내용 -->
      <div class="mb-3">
        <textarea class="form-control" name="content" rows="3" placeholder="댓글을 남겨보세요"></textarea>
      </div>

      <!-- 이미지 첨부 -->
      <div class="mb-3">
        <label for="commentImages" class="form-label">이미지 첨부</label>
        <input class="form-control" type="file" id="commentImages" name="images" accept="image/*" multiple>
      </div>

      <!-- 이미지 미리보기 영역 -->
      <div id="previewContainer" class="preview-container mb-3">
        <!-- JavaScript에서 동적으로 미리보기 img 태그를 생성하여 삽입 -->
      </div>

      <button type="submit" class="btn btn-success">등록</button>
    </form>
  </div>


</div>

<!-- 푸터 아래 추가 여백 -->
<div class="footer-padding"></div>

<!-- Footer -->
<div th:replace="~{layouts/footer :: footer}"></div>

<script>
  const commentImagesInput = document.getElementById("commentImages");
  const previewContainer = document.getElementById("previewContainer");

  // 파일이 변경될 때마다 실행
  commentImagesInput.addEventListener("change", (event) => {
    // 기존 미리보기 초기화
    previewContainer.innerHTML = "";

    const files = event.target.files;
    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      const reader = new FileReader();

      reader.onload = (e) => {
        // 프리뷰 표시용 요소 생성
        const previewItem = document.createElement("div");
        previewItem.classList.add("preview-item", "me-2", "mb-2");

        const img = document.createElement("img");
        img.src = e.target.result;
        img.classList.add("preview-img");
        previewItem.appendChild(img);

        // 삭제 버튼
        const removeBtn = document.createElement("button");
        removeBtn.type = "button";
        removeBtn.innerText = "x";
        removeBtn.classList.add("btn", "btn-danger", "btn-sm", "remove-btn");
        removeBtn.addEventListener("click", () => {
          removeFile(file);
          previewItem.remove();
        });

        previewItem.appendChild(removeBtn);
        previewContainer.appendChild(previewItem);
      };
      // 로컬 파일을 DataURL(base64)로 읽어 미리보기
      reader.readAsDataURL(file);
    }
  });

  // 개별 파일 삭제 (input[type='file']에서 특정 파일만 제거)
  function removeFile(file) {
    const dt = new DataTransfer();
    const currentFiles = commentImagesInput.files;

    for (let i = 0; i < currentFiles.length; i++) {
      if (currentFiles[i] !== file) {
        dt.items.add(currentFiles[i]);
      }
    }
    commentImagesInput.files = dt.files; // 새로 갱신
  }
</script>

</body>
</html>
