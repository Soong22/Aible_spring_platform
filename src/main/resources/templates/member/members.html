<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>전체 유저 조회</title>
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- CSS 파일 참조 -->
    <link rel="stylesheet" th:href="@{/css/fragments/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/fragments/header.css}">
    <link rel="stylesheet" th:href="@{/css/fragments/footer.css}">
    <link rel="stylesheet" th:href="@{/css/fragments/scrollbar.css}">

    <style>
        html, body {
            height: 100%; /* 페이지 전체를 스크롤 가능하게 설정 */
            margin: 0;
            overflow-y: auto; /* 세로 스크롤 허용 */
            background-color: #f8f9fa;
        }

        :root {
            --table-header-bg: #003366; /* 기본 헤더 색상 (파란색) */
            --table-header-text: white;
        }

        .table-container {
            margin-top: 100px;
            background-color: white;
            border: 1px solid #e9ecef;

            border-radius: 12px;
            padding: 20px 40px 20px 40px; /* 폼과 테이블 간격 증가 */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);

            overflow-x: auto; /* ✅ 가로 스크롤 추가 */
            -webkit-overflow-scrolling: touch; /* ✅ 모바일에서 부드러운 스크롤 */
            max-width: 100%; /* ✅ 부모 요소를 벗어나지 않도록 설정 */
        }

        .table-container h1 {
            text-align: left;
            color: #003366;
            margin-bottom: 20px;
        }

        /* 테이블 스타일 */
        .table {
            /*table-layout: fixed;*/
            min-width: 900px; /* ✅ 테이블이 너무 작아지지 않도록 최소 너비 설정 */
            table-layout: auto; /* ✅ 셀 크기 자동 조정 */
            white-space: nowrap; /* ✅ 텍스트 줄바꿈 방지 */

            border: 1px solid #ddd; /* 컬럼 구분선 */

            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 12px; /* 테이블도 둥글게 */
            overflow: hidden;
        }

        /* 헤더 스타일 */
        .table thead th {
            background-color: var(--table-header-bg);
            color: var(--table-header-text);
            text-align: center;
            vertical-align: middle;
            padding: 12px;
            border-right: 1px solid #ddd; /* 컬럼 구분선 */
        }

        .table thead th:last-child {
            border-right: none; /* 마지막 컬럼에는 테두리 제거 */
        }

        /* 첫 번째 컬럼(#, 행번호) 스타일 */
        .table tbody th:first-child {
            background-color: white !important;
            color: black;
            text-align: center;
            vertical-align: middle;
            border-right: 1px solid #ddd; /* 컬럼 구분선 */
        }

        /* 일반 행 스타일 */
        .table tbody td {
            text-align: center;
            vertical-align: middle;
            padding: 16px;
            border-right: 1px solid #ddd; /* 컬럼 구분선 */
        }

        .table tbody td:last-child {
            border-right: none; /* 마지막 컬럼에는 테두리 제거 */
        }

        /* 클릭 가능한 행 스타일 */
        .clickable-row:hover {
            background-color: #f1f1f1;
            cursor: pointer;
        }

        /* 컬럼별 너비 설정 */
        .table th:nth-child(1), .table td:nth-child(1) {
            width: 5%;
        }

        .table th:nth-child(2), .table td:nth-child(2) {
            width: 15%;
        }

        .table th:nth-child(3), .table td:nth-child(3) {
            width: 20%;
        }

        .table th:nth-child(4), .table td:nth-child(4) {
            width: 10%;
        }

        .table th:nth-child(5), .table td:nth-child(5) {
            width: 15%;
        }

        .table th:nth-child(6), .table td:nth-child(6) {
            width: 15%;
        }

        .table th:nth-child(7), .table td:nth-child(7) {
            width: 15%;
        }

        .table th:nth-child(8), .table td:nth-child(8) {
            width: 20%;
        }

        /* 현재 선택된 페이지 버튼 색상 변경 */
        .pagination .page-item.active .page-link {
            background-color: #003366 !important;
            border-color: #003366 !important;
            color: white !important;
        }

        /* 기본 페이지 버튼 색상 유지 (필요한 경우 추가) */
        .pagination .page-link {
            color: #003366;
        }

        /* 페이지 버튼 호버 시 색상 변경 */
        .pagination .page-link:hover {
            background-color: #0073e6; /* 조금 더 밝은 파란색 */
            border-color: #0073e6;
            color: white;
        }

    </style>

    <!-- Font Awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js" defer></script>

    <script th:inline="javascript" th:if="${errorMessage != null}">
        /*<![CDATA[*/
        var msg = /*[[${errorMessage}]]*/ "";
        alert(msg);
        /*]]>*/
    </script>

    <script>
        function goToMemberPage(memberId) {
            location.href = `/member/${memberId}`;
        }
    </script>
</head>
<body>

<!-- 사이드바 -->
<div th:replace="~{fragments/sidebar :: sidebar}" id="sidebar"></div>

<!-- 헤더 -->
<div th:replace="~{fragments/header :: header}" class="header"></div>

<!-- 메인 콘텐츠 -->
<div class="team24-container">
    <div class="container mt-5">
        <div class="table-container">
            <div class="table-responsive">
                <h1 class="mb-4 text-left">전체 유저 조회</h1>
                <table class="table table-hover">
                    <colgroup>
                        <col style="width: 5%;">
                        <col style="width: 15%;">
                        <col style="width: 20%;">
                        <col style="width: 10%;">
                        <col style="width: 15%;">
                        <col style="width: 15%;">
                        <col style="width: 15%;">
                        <col style="width: 20%;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th>#</th>
                        <th>이름</th>
                        <th>이메일</th>
                        <th>권한</th>
                        <th>개인 전화번호</th>
                        <th>사무실 전화번호</th>
                        <th>가입일자</th>
                        <th>소속</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="member, memberStat : ${members}" class="clickable-row"
                        th:onclick="|goToMemberPage(${member.memberId})|">

                        <th scope="row" th:text="${members.number * members.size + memberStat.count}">1</th>
                        <td th:text="${member.memberName}">이름</td>
                        <td th:text="${member.email}">이메일</td>
                        <td th:text="${member.role}">권한</td>
                        <td th:text="${member.personPhone}">전화번호</td>
                        <td th:text="${member.officePhone}">전화번호</td>
                        <td th:text="${#temporals.format(member.createdAt, 'yyyy.MM.dd')}">가입일자</td>
                        <td>
                        <span th:if="${member.policeUnitId != null && policeUnits[member.policeUnitId] != null}"
                              th:text="${policeUnits[member.policeUnitId].policeUnitName + ' ' + policeUnits[member.policeUnitId].policeUnitTypeDescription}">
                        </span>
                            <span th:unless="${member.policeUnitId != null && policeUnits[member.policeUnitId] != null}">정보 없음</span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- 페이징 -->
            <nav th:if="${members.totalPages > 1}" class="mt-4">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${members.hasPrevious() ? '' : 'disabled'}">
                        <a class="page-link" th:href="@{/members(page=${members.number - 1})}" aria-label="이전">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item" th:each="pageNum : ${#numbers.sequence(0, members.totalPages - 1)}"
                        th:classappend="${pageNum == members.number ? 'active' : ''}">
                        <a class="page-link" th:href="@{/members(page=${pageNum})}" th:text="${pageNum + 1}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${members.hasNext() ? '' : 'disabled'}">
                        <a class="page-link" th:href="@{/members(page=${members.number + 1})}" aria-label="다음">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- 푸터 아래 추가 여백 -->
<div class="team24-footer-padding"></div>

<!-- 푸터 -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- JavaScript -->
<script src="/js/fragments/sidebar.js"></script>
<script src="/js/fragments/scrollbar.js"></script>

</body>
</html>
